\section{Proposed solutions}

\subsection{Avoiding the undefined behavior}

We propose to avoid the undefined behavior by clarifying the semantics of every
build mode in regards of both evaluation of conditions and asumption of those
conditions. For assumption of conditions the clarification needs to address the
case where continuation is disabled and when the continuation is enables.

To define such sematics we propose to follow the following simple principles:

\begin{itemize}

\item A contract that, in a given build mode, is not evaluated cannot be used
for any kind of assumption. This leads to modes where only contracts that have
been checked are used for assumptions and avoiding in this way the identified
paths towards undefined behavior.

\item Moreover, contracts that have been checked can only be assumed if the
continuation mode has been disabled. Otherwise, such assumptions cannot be made.

\item Axiom contract are considered as if they had been evaluated unless the
build mode is off. This leads to a mode where no checking is made but no
assumption is made either.

\end{itemize}

Below, we identify what are the exact semantics of each build level when applied
to each contract level.

\subsubsection{Build mode audit}

\begin{tabular}{|l|c|c|c|}
\hline
\emph{contract-level} & evaluated & \multicolumn{2}{c|}{assumed}\\
& & continuation on & continuation off\\
\hline
\hline
\cppid{audit} & yes & no & yes\\
\hline
\cppid{default} & yes & no & yes\\
\hline
\cppid{axiom} & no & yes & yes\\
\hline
\end{tabular}

\subsubsection{Build mode default}

\begin{tabular}{|l|c|c|c|}
\hline
\emph{contract-level} & evaluated & \multicolumn{2}{c|}{assumed}\\
& & continuation on & continuation off\\
\hline
\hline
\cppid{audit} & no & no & no\\
\hline
\cppid{default} & yes & no & yes\\
\hline
\cppid{axiom} & no & yes & yes\\
\hline
\end{tabular}

\subsubsection{Build mode off}

\begin{tabular}{|l|c|c|c|}
\hline
\emph{contract-level} & evaluated & \multicolumn{2}{c|}{assumed}\\
& & continuation on & continuation off\\
\hline
\hline
\cppid{audit} & no & no & no\\
\hline
\cppid{default} & no & no & no\\
\hline
\cppid{axiom} & no & no & no\\
\hline
\end{tabular}

\subsection{Allowing assumption of axioms}

The new semantics for the existing build modes avoids undefined behavior, but
lets no room for asumption of axiom contracts. Note that this might be
interesting for expressing assertions that are known to be true.

We propose a new build mode \textmark{axiom}, where only \cppid{axiom} contracts
are assumed.

\subsubsection{Build mode axiom}

\begin{tabular}{|l|c|c|c|}
\hline
\emph{contract-level} & evaluated & \multicolumn{2}{c|}{assumed}\\
& & continuation on & continuation off\\
\hline
\hline
\cppid{audit} & no & no & no\\
\hline
\cppid{default} & no & no & no\\
\hline
\cppid{axiom} & no & yes & yes\\
\hline
\end{tabular}

\subsection{Summary of sematics}

In this section we summarize the build options and their semantics.

The translation is controlled by the following options:

\begin{itemize}
  \item Build level: \cppid{off}, \cppid{axiom}, \cppid{default}, and \cppid{audit}.
  \item Continuation mode: \cppid{off}, \cppid{on}.
\end{itemize}

However, note that when build level is \cppid{off} or \cppid{axiom} the effecct of the
continuation mode is irrelevant. This leads us to six possible combinations.

\begin{enumerate}

\item Build-level=\cppid{off}, continuation=\cppid{off|on}.
\begin{itemize}
  \item No check is performed.
  \item No assumption is made.
\end{itemize}

\item Build-level=\cppid{axiom}, continuation=\cppid{off|on}.
\begin{itemize}
  \item No check is performed.
  \item Checks with \cppid{axiom} level are assumed.
\end{itemize}

\item Build-level=\cppid{default}, continuation=\cppid{off}
\begin{itemize}
  \item Checks with \cppid{default} level are evaluated and assumed.
  \item Checks with \cppid{axiom} level are assumed.
\end{itemize}

\item Build-level=\cppid{default}, continuation=\cppid{on}
\begin{itemize}
  \item Checks with \cppid{default} level are evaluated but not assumed.
  \item Checks with \cppid{axiom} level are assumed.
\end{itemize}

\item Build-level=\cppid{audit}, continuation=\cppid{off}
\begin{itemize}
  \item Checks with \cppid{audit} level are evaluated and assumed.
  \item Checks with \cppid{default} level are evaluated and assumed.
  \item Checks with \cppid{axiom} level are assumed.
\end{itemize}

\item Build-level=\cppid{audit}, continuation=\cppid{on}
\begin{itemize}
  \item Checks with \cppid{audit} level are evaluated but not assumed.
  \item Checks with \cppid{default} level are evaluated but not assumed.
  \item Checks with \cppid{axiom} level are assumed.
\end{itemize}
\end{enumerate}
